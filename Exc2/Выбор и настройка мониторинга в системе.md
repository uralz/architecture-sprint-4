### Мотивация

Для мониторинга информационной системы компании предлагаю использовать комбинацию подходов RED, USE и «Четыре золотых сигнала». Это позволит понимать процессы, происходящие в системе и принимать более качественные решения для исправления ее недостатков.
Метрики производительности позволят увидеть проблему еще на подходе предотвратить полный отказ системы своевременными действиями.
Бизнес метрики позволят собрать статистику для понимания динамики новых пользователей, прогнозов выручки и нагрузки на производство.

### Выбор подхода к мониторингу
#### MES и Message Queue
Для этих частей системы предлагаю использовать подход USE. Поскольку расчет стоимости в MES самый ресурсозатратный, нам важно отслеживать загруженность приложения (Utilization) и количество заказов на расчет, ожидающих в очереди (Saturation).

Метрики:
- **"CPU %"** и **"Memory Utilisation"** для MES. Метрики, показывающие загруженность приложения.  Ярлыки: приложение.
- **"Number of message in flight"** для RabbitMQ. Метрика, показывающая количество заказов, ожидающих расчета. Ярлыков нет.
- **"Number of dead-letter-exchange"** для RabbitMQ. Метрика показывающая количество заказов, отклоненных очередью. Ярлык - ошибка (причина события).
#### MES API
Для MES API предлагаю использовать подход «Четыре золотых сигнала». Этот подход позволит увидеть аномалии в работе API для внешних пользователей и вовремя среагировать.

Метрики:
 - **"RPS"**. Метрика, показывающая количество запросов в секунду. Ярлыки: сервис, эндпоинт, метод запроса.
- "**HTTP Errors**". Метрика, показывающая количество ошибок запросов. Ярлыки: сервис, эндпоинт, метод запроса, код ошибки.
- **"Response time"**. Время между запросом и ответом. Ярлыки: сервис, эндпоинт, метод запроса.
- **"CPU %"** и **"Memory Utilisation"** для MES API. Метрики, показывающие загруженность приложения.  Ярлыки: приложение.
- **"DAU"**. Сюда же предлагаю добавить метрику DAU для отслеживания динамики использования API и последующей аналитики.
#### Shop API, CRM API
Для этих частей системы предлагаю использовать подход RED. Этого будет достаточно для понимания в порядке ли эти системы.

Метрики:
- **"RPS"**. Метрика, показывающая количество запросов в секунду. Ярлыки: сервис, эндпоинт, метод запроса.
- "**HTTP Errors**". Метрика, показывающая количество ошибок запросов. Ярлыки: сервис, эндпоинт, метод запроса, код ошибки.
- **"Response time"**. Время между запросом и ответом. Ярлыки: сервис, эндпоинт, метод запроса.
#### Shop DB, MES DB
Для мониторинга БД предлагаю в качестве основы использовать подход RED. Для наблюдения за клиентской активностью в Postgres есть несколько представлений (views), например pg_stat_statements, pg_stat_activity, pg_stat_database.

С их помощью можно получить нужные метрики:
- **"RPS"**. Количество запросов в секунду. Ярлыки: база данных.
- **"Errors"**. Количество ошибок, связанных с запросами. Ярлыки: база данных, ошибка.
- **"Duration"**. Метрика времени выполнения запросов. Ярлыки: база данных.
- **"Number of connections for DB"**. Метрика, показывающая кол-во соединений с БД. Позволит отследить аномалии в работе приложений, когда соединения по каким-либо причнам не закрываются. Ярлыки: база данных.
#### S3 Storage
Для мониторинга хранилища в качестве основы предлагаю также использовать подход RED.

Выберем следующие метрики:
- **"RPS"**. Метрика показывает кол-во операций в секунду. Ярклыки: метод запроса
- "**HTTP Errors**". Метрика, показывающая количество ошибок запросов. Ярлыки: метод запроса, код ошибки.
- **"Request Latency"**. Метрика показывает задержку запросов. Ярлыки: метод запроса
- "**Size of S3 storage**". Метрика размера хранилища.
### План действий
1. Установить и настроить Prometheus и time-series db (например InfluxDB)
2. В соответствии с планом настроить экспортеры метрик
3. Установить Grafana и подключить ее к Prometheus
4. Создать дашборды и настроить алерты
